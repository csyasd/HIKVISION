# appsettings.json 配置说明

## 配置文件说明

### 基本配置

```json
{
  "Logging": {
    "LogLevel": {
      "Default": "Information", // 默认日志级别
      "Microsoft.AspNetCore": "Warning" // ASP.NET Core日志级别
    }
  },
  "AllowedHosts": "*" // 允许的主机（*表示允许所有）
}
```

### PLC 连接配置 (PlcConfig)

```json
{
  "PlcConfig": {
    "IpAddress": "192.168.0.1", // PLC的IP地址
    "Rack": 0, // 机架号
    "Slot": 1, // 槽位号
    "DataBlockNumber": 1, // 数据块编号
    "TimeoutMs": 5000 // 连接超时时间（毫秒）
  }
}
```

## 参数详细说明

### IpAddress (IP 地址)

- **说明**: PLC 的 IP 地址
- **示例**: "192.168.0.1"
- **注意**: 确保您的计算机与 PLC 在同一网络中，且能够 ping 通 PLC 的 IP 地址

### Rack (机架号)

- **说明**: PLC 的机架号
- **S7-200**: 通常为 0
- **S7-300/400**: 通常为 0
- **S7-1200/1500**: 通常为 0

### Slot (槽位号)

- **说明**: PLC 的槽位号
- **S7-200**: 通常为 0 或 1
- **S7-300/400**: 通常为 2
- **S7-1200/1500**: 通常为 1

### DataBlockNumber (数据块编号)

- **说明**: 要读取的数据块编号
- **示例**: 1 (表示读取 DB1 块)
- **根据您的图片示例**: DB1 包含以下数据：
  - DBD0: GPS_lon (GPS 经度) - Real 类型
  - DBD4: Gps_lat (GPS 纬度) - Real 类型
  - DBW8: Device_ID (设备 ID) - Int 类型

### TimeoutMs (超时时间)

- **说明**: 连接超时时间，单位为毫秒
- **推荐值**: 5000 (5 秒)
- **注意**: 如果 PLC 响应较慢，可以适当增加此值

## 常见配置示例

### S7-1200 PLC

```json
{
  "PlcConfig": {
    "IpAddress": "192.168.1.100",
    "Rack": 0,
    "Slot": 1,
    "DataBlockNumber": 1,
    "TimeoutMs": 5000
  }
}
```

### S7-300 PLC

```json
{
  "PlcConfig": {
    "IpAddress": "192.168.1.101",
    "Rack": 0,
    "Slot": 2,
    "DataBlockNumber": 1,
    "TimeoutMs": 5000
  }
}
```

## 故障排除

### 连接失败 (10061 错误)

- **原因**: 目标计算机积极拒绝连接
- **解决方案**:
  1. 检查 PLC IP 地址是否正确
  2. 确认 PLC 与计算机在同一网络
  3. 使用 ping 命令测试网络连通性
  4. 检查 PLC 的机架号和槽位号设置

### 连接超时

- **原因**: PLC 响应时间过长
- **解决方案**: 增加 TimeoutMs 的值

### 数据读取失败

- **原因**: 数据块不存在或偏移量错误
- **解决方案**:
  1. 确认 PLC 中存在对应的 DB 块
  2. 检查数据块布局是否与代码中的偏移量匹配
  3. 确认数据类型是否正确

## 网络配置检查

### 1. 测试网络连通性

```bash
ping 192.168.0.1
```

### 2. 检查端口连接

```bash
telnet 192.168.0.1 102
```

### 3. 确认 PLC 设置

- PLC 的 IP 地址设置
- 子网掩码设置
- 网关设置（如果需要）
- 防火墙设置

## 注意事项

1. **安全**: 在生产环境中，建议限制 AllowedHosts 的范围
2. **性能**: 根据实际需求调整超时时间和日志级别
3. **备份**: 修改配置前请备份原始配置文件
4. **测试**: 修改配置后请先在测试环境中验证
